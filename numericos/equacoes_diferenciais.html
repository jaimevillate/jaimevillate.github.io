<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>3. Equações diferenciais</title>
<link rel="stylesheet" href="../css/book.css">
<link rel="icon" type="image/svg+xml" href="../img/favicon.svg">
<link rel="alternate icon" href="../img/favicon.ico">
</head>
<body>
<header style="background-image:url(../img/numericos.png);
               background-repeat:no-repeat;
               background-position:right center">
<h1 id="title">3. Equações diferenciais</h1>
</header>
<div class="menu">
<button class="menubtn">&#9776;</button>
<div class="menu-content">
<a href="../pt/index.html">Início</a>
<a href="../pt/courses/index.html">Disciplinas</a>
<a href="../pt/courses/computational_physics/index.html">Física Computacional</a>
<a href="./index.html">Métodos Numéricos</a>
</div>
</div>
<section>
<h2 id="sec-3.1">3.1. Forma geral das equações diferenciais</h2>
<p>
Uma <span class="concept">equação diferencial ordinária</span>
&mdash;ou de forma abreviada, EDO&mdash; de ordem <math id="eqn1" display="inline"><mrow><mi>n</mi></mrow></math> é uma relação
entre uma função <math id="eqn2" display="inline"><mrow><mi>y</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow></math> e as suas derivadas <math id="eqn3" display="inline"><mrow><mi>y</mi><mi>′</mi></mrow></math>,
<math id="eqn4" display="inline"><mrow><mi>y</mi><mi>′</mi><mi>′</mi></mrow></math>, &hellip;, <math id="eqn5" display="inline"><mrow><msup><mi>y</mi><mrow><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mrow></msup></mrow></math>. Por exemplo, uma possível
equação diferencial ordinária de terceira ordem é:
</p>
<div class="eqnalign" id="eq-3.1">
<div class="eqn">(3.1)</div>
<math id="eqn6" display="inline"><mrow><mn>3</mn><mspace width="0.167em" /><msup><mi>x</mi><mn>2</mn></msup><mspace width="0.167em" /><mi>y</mi><mi>′</mi><mi>′</mi><mi>′</mi><mo>+</mo><mstyle displaystyle="true" scriptlevel="0"><mfrac><mrow><mi>y</mi></mrow><mrow><mn>2</mn><mspace width="0.167em" /><mi>y</mi><mi>′</mi></mrow></mfrac></mstyle><mo>=</mo><mi>x</mi><mspace width="0.167em" /><mi>y</mi><mi>′</mi><mi>′</mi></mrow></math>
</div>
<p>
Neste caso, é possível também escrever a equação mostrando
explicitamente a expressão que define a derivada de terceira ordem:
</p>
<div class="eqnalign" id="eq-3.2">
<div class="eqn">(3.2)</div>
<math id="eqn7" display="inline"><mrow><mi>y</mi><mi>′</mi><mi>′</mi><mi>′</mi><mo>=</mo><mstyle displaystyle="true" scriptlevel="0"><mfrac><mrow><mi>y</mi><mi>′</mi><mi>′</mi></mrow><mrow><mn>3</mn><mspace width="0.167em" /><mi>x</mi></mrow></mfrac></mstyle><mo>−</mo><mstyle displaystyle="true" scriptlevel="0"><mfrac><mrow><mi>y</mi></mrow><mrow><mn>6</mn><mspace width="0.167em" /><msup><mi>x</mi><mn>2</mn></msup><mspace width="0.167em" /><mi>y</mi><mi>′</mi></mrow></mfrac></mstyle></mrow></math>
</div>
<p>
É conveniente usar uma notação que permite ver a equação de forma mais
geral: a função <math id="eqn8" display="inline"><mrow><mi>y</mi></mrow></math> será denotada por <math id="eqn9" display="inline"><mrow><msub><mi>y</mi><mn>1</mn></msub></mrow></math>, <math id="eqn10" display="inline"><mrow><msub><mi>y</mi><mn>2</mn></msub></mrow></math> será a primeira
derivada <math id="eqn11" display="inline"><mrow><mi>y</mi><mi>′</mi></mrow></math> e <math id="eqn12" display="inline"><mrow><msub><mi>y</mi><mn>3</mn></msub></mrow></math> a segunda derivada <math id="eqn13" display="inline"><mrow><mi>y</mi><mi>′</mi><mi>′</mi></mrow></math>. A
equação diferencial é então:
</p>
<div class="eqnalign" id="eq-3.3">
<div class="eqn">(3.3)</div>
<math id="eqn14" display="inline"><mrow><msub><mi>y</mi><mn>3</mn></msub><mi>′</mi><mo>=</mo><mstyle displaystyle="true" scriptlevel="0"><mfrac><mrow><msub><mi>y</mi><mn>3</mn></msub></mrow><mrow><mn>3</mn><mspace width="0.167em" /><mi>x</mi></mrow></mfrac></mstyle><mo>−</mo><mstyle displaystyle="true" scriptlevel="0"><mfrac><mrow><msub><mi>y</mi><mn>1</mn></msub></mrow><mrow><mn>6</mn><mspace width="0.167em" /><msup><mi>x</mi><mn>2</mn></msup><mspace width="0.167em" /><msub><mi>y</mi><mn>2</mn></msub></mrow></mfrac></mstyle></mrow></math>
</div>
<p>
que define a derivada de <math id="eqn15" display="inline"><mrow><msub><mi>y</mi><mn>2</mn></msub></mrow></math> em relação a (<math id="eqn16" display="inline"><mrow><mi>x</mi></mrow></math>, <math id="eqn17" display="inline"><mrow><msub><mi>y</mi><mn>1</mn></msub></mrow></math>, <math id="eqn18" display="inline"><mrow><msub><mi>y</mi><mn>2</mn></msub></mrow></math>,
<math id="eqn19" display="inline"><mrow><msub><mi>y</mi><mn>3</mn></msub></mrow></math>). Para resolver este problema é necessário resolver
simultaneamente as equações que definem as derivadas de <math id="eqn20" display="inline"><mrow><msub><mi>y</mi><mn>1</mn></msub></mrow></math> e
<math id="eqn21" display="inline"><mrow><msub><mi>y</mi><mn>2</mn></msub></mrow></math>. Ou seja, a equação original&nbsp;(<a href="#eq-3.1">3.1</a>),
de terceira ordem, foi transformada no sistema de 3 equações:
</p>
<div class="eqnalign" id="eq-3.4">
<div class="eqn">(3.4)</div>
<math id="eqn22" display="block"><mrow><mtable displaystyle="true" rowspacing="3pt" columnspacing="0em 2em"><mtr><mtd columnalign="right" /><mtd columnalign="left"><mi /><msub><mi>y</mi><mn>1</mn></msub><mi>′</mi><mo>=</mo><msub><mi>y</mi><mn>2</mn></msub></mtd></mtr><mtr><mtd columnalign="right" /><mtd columnalign="left"><mi /><msub><mi>y</mi><mn>2</mn></msub><mi>′</mi><mo>=</mo><msub><mi>y</mi><mn>3</mn></msub></mtd></mtr><mtr><mtd columnalign="right" /><mtd columnalign="left"><mi /><msub><mi>y</mi><mn>3</mn></msub><mi>′</mi><mo>=</mo><mstyle displaystyle="true" scriptlevel="0"><mfrac><mrow><msub><mi>y</mi><mn>3</mn></msub></mrow><mrow><mn>3</mn><mspace width="0.167em" /><mi>x</mi></mrow></mfrac></mstyle><mo>−</mo><mstyle displaystyle="true" scriptlevel="0"><mfrac><mrow><msub><mi>y</mi><mn>1</mn></msub></mrow><mrow><mn>6</mn><mspace width="0.167em" /><msup><mi>x</mi><mn>2</mn></msup><mspace width="0.167em" /><msub><mi>y</mi><mn>2</mn></msub></mrow></mfrac></mstyle></mtd></mtr></mtable></mrow></math>
</div>
<p>
Esta forma de escrever a equação diferencial tem também a vantagem de
poder ser escrita de forma mais compacta; define-se o vetor,
</p>
<div class="eqnalign" id="eq-3.5">
<div class="eqn">(3.5)</div>
<math id="eqn23" display="inline"><mrow><mover><mrow><mi>y</mi></mrow><mo stretchy="false">→</mo></mover><mo>=</mo><mo stretchy="false">(</mo><msub><mi>y</mi><mn>1</mn></msub><mo>,</mo><msub><mi>y</mi><mn>2</mn></msub><mo>,</mo><msub><mi>y</mi><mn>3</mn></msub><mo stretchy="false">)</mo></mrow></math>
</div>
<p>
e o sistema de 3 equações diferenciais é equivalente a uma única
equação diferencial vetorial:
</p>
<div class="eqnalign" id="eq-3.6">
<div class="eqn">(3.6)</div>
<math id="eqn24" display="inline"><mrow><mstyle displaystyle="true" scriptlevel="0"><mfrac><mrow><mi>d</mi><mover><mrow><mi>y</mi></mrow><mo stretchy="false">→</mo></mover></mrow><mrow><mi>d</mi><mi>x</mi></mrow></mfrac></mstyle><mo>=</mo><mover><mrow><mi>f</mi></mrow><mo stretchy="false">→</mo></mover><mo stretchy="false">(</mo><mi>x</mi><mo>,</mo><mover><mrow><mi>y</mi></mrow><mo stretchy="false">→</mo></mover><mo stretchy="false">)</mo></mrow></math>
</div>
<p>
onde a derivada do vetor <math id="eqn25" display="inline"><mrow><mover><mrow><mi>y</mi></mrow><mo stretchy="false">→</mo></mover></mrow></math> é outro vetor obtido derivando cada
uma das suas componentes,
</p>
<div class="eqnalign" id="eq-3.7">
<div class="eqn">(3.7)</div>
<math id="eqn26" display="inline"><mrow><mstyle displaystyle="true" scriptlevel="0"><mfrac><mrow><mi>d</mi><mover><mrow><mi>y</mi></mrow><mo stretchy="false">→</mo></mover></mrow><mrow><mi>d</mi><mi>x</mi></mrow></mfrac></mstyle><mo>=</mo><mo stretchy="false">(</mo><msub><mi>y</mi><mn>1</mn></msub><mi>′</mi><mo>,</mo><msub><mi>y</mi><mn>2</mn></msub><mi>′</mi><mo>,</mo><msub><mi>y</mi><mn>3</mn></msub><mi>′</mi><mo stretchy="false">)</mo></mrow></math>
</div>
<p>
Por exemplo, no caso do sistema de equações
(<a href="#eq-3.4">3.4</a>), as três componentes da função vetorial
<math id="eqn27" display="inline"><mrow><mover><mrow><mi>f</mi></mrow><mo stretchy="false">→</mo></mover><mo stretchy="false">(</mo><mi>x</mi><mo>,</mo><mover><mrow><mi>y</mi></mrow><mo stretchy="false">→</mo></mover><mo stretchy="false">)</mo></mrow></math> são,
</p>
<div class="eqnalign" id="eq-3.8">
<div class="eqn">(3.8)</div>
<math id="eqn28" display="inline"><mrow><mover><mrow><mi>f</mi></mrow><mo stretchy="false">→</mo></mover><mo stretchy="false">(</mo><mi>x</mi><mo>,</mo><mover><mrow><mi>y</mi></mrow><mo stretchy="false">→</mo></mover><mo stretchy="false">)</mo><mo>=</mo><mrow><mo stretchy="true" fence="true" form="prefix">(</mo><msub><mi>y</mi><mn>2</mn></msub><mo>,</mo><msub><mi>y</mi><mn>3</mn></msub><mo>,</mo><mstyle displaystyle="true" scriptlevel="0"><mfrac><mrow><msub><mi>y</mi><mn>3</mn></msub></mrow><mrow><mn>3</mn><mspace width="0.167em" /><mi>x</mi></mrow></mfrac></mstyle><mo>−</mo><mstyle displaystyle="true" scriptlevel="0"><mfrac><mrow><msub><mi>y</mi><mn>1</mn></msub></mrow><mrow><mn>6</mn><mspace width="0.167em" /><msup><mi>x</mi><mn>2</mn></msup><mspace width="0.167em" /><msub><mi>y</mi><mn>2</mn></msub></mrow></mfrac></mstyle><mo stretchy="true" fence="true" form="postfix">)</mo></mrow></mrow></math>
</div>
<p>
Como tal, para resolver equações diferencias ordinárias como, por
exemplo, a equação&nbsp;(<a href="#eq-3.1">3.1</a>), basta saber
resolver equações de primeira ordem com a forma geral
</p>
<div class="eqnalign" id="eq-3.9">
<div class="eqn">(3.9)</div>
<math id="eqn29" display="inline"><mrow><mstyle displaystyle="true" scriptlevel="0"><mfrac><mrow><mrow><mi mathvariant="normal">d</mi></mrow><mi>y</mi></mrow><mrow><mrow><mi mathvariant="normal">d</mi></mrow><mi>x</mi></mrow></mfrac></mstyle><mo>=</mo><mi>f</mi><mo stretchy="false">(</mo><mi>x</mi><mo>,</mo><mi>y</mi><mo stretchy="false">)</mo></mrow></math>
</div>
<p>
e generalizar o método ao caso em que <math id="eqn30" display="inline"><mrow><mi>y</mi></mrow></math> e <math id="eqn31" display="inline"><mrow><mi>f</mi></mrow></math> são vetores com várias
componentes.
</p>
</section>
<section>
<h2 id="sec-3.2">3.2. Equações diferenciais de primeira ordem</h2>
<p>
A forma geral das EDO de primeira ordem é
</p>
<div class="eqnalign" id="eq-3.10">
<div class="eqn">(3.10)</div>
<math id="eqn32" display="inline"><mrow><mi>y</mi><mi>′</mi><mo>=</mo><mi>f</mi><mo stretchy="false">(</mo><mi>x</mi><mo>,</mo><mi>y</mi><mo stretchy="false">)</mo></mrow></math>
</div>
<p>
A função <math id="eqn33" display="inline"><mrow><mi>y</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow></math> chama-se <span class="concept">variável
dependente</span> e <math id="eqn34" display="inline"><mrow><mi>x</mi></mrow></math> é a <span class="concept">variável
independente</span>. Uma solução da EDO, num intervalo [<math id="eqn35" display="inline"><mrow><msub><mi>x</mi><mn>0</mn></msub></mrow></math>, <math id="eqn36" display="inline"><mrow><msub><mi>x</mi><mi>n</mi></msub></mrow></math>],
é qualquer função <math id="eqn37" display="inline"><mrow><mi>y</mi></mrow></math> de <math id="eqn38" display="inline"><mrow><mi>x</mi></mrow></math> que verifica a equação.
</p>
<p>
Existem em geral muitas soluções, por exemplo, a
Figura&nbsp;<a href="#fig-3.1">3.1</a> mostra 7 possíveis soluções da
equação <math id="eqn39" display="inline"><mrow><mi>y</mi><mi>′</mi><mo>=</mo><mo stretchy="false">(</mo><mi>x</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo><mo stretchy="false">(</mo><mi>x</mi><mo>−</mo><mn>3</mn><mo stretchy="false">)</mo><mo>−</mo><mi>y</mi></mrow></math>. Em cada ponto de cada uma das
curvas, o declive tem o mesmo valor obtido substituindo as coordenadas
do ponto na expressão <math id="eqn40" display="inline"><mrow><mo stretchy="false">(</mo><mi>x</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo><mo stretchy="false">(</mo><mi>x</mi><mo>−</mo><mn>3</mn><mo stretchy="false">)</mo><mo>−</mo><mi>y</mi></mrow></math>. As diferentes soluções não se
cruzam nunca, porque em cada ponto existe apenas um valor
<math id="eqn41" display="inline"><mrow><mo stretchy="false">(</mo><mi>x</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo><mo stretchy="false">(</mo><mi>x</mi><mo>−</mo><mn>3</mn><mo stretchy="false">)</mo><mo>−</mo><mi>y</mi></mrow></math> e cada ponto <math id="eqn42" display="inline"><mrow><mo stretchy="false">(</mo><mi>x</mi><mo>,</mo><mi>y</mi><mo stretchy="false">)</mo></mrow></math> pertence unicamente a uma das
soluções da equação diferencial.
</p>
<figure class="center" id="fig-3.1">
<img class="fig" src="img/solucoes_EDO.png"
     alt="Soluções de uma equação diferencial de primeira ordem"
     style="width:30em;max-width:100%;height:auto">
<figcaption><b>Figura 3.1:</b> Soluções da equação diferencial
<math id="eqn43" display="inline"><mrow><mi>y</mi><mi>′</mi><mo>=</mo><mo stretchy="false">(</mo><mi>x</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo><mo stretchy="false">(</mo><mi>x</mi><mo>−</mo><mn>3</mn><mo stretchy="false">)</mo><mo>−</mo><mi>y</mi></mrow></math>.</figcaption>
</figure>
<p>
Se for dado um valor inicial <math id="eqn44" display="inline"><mrow><msub><mi>y</mi><mn>0</mn></msub></mrow></math> para a função <math id="eqn45" display="inline"><mrow><mi>y</mi></mrow></math> no ponto inicial
<math id="eqn46" display="inline"><mrow><msub><mi>x</mi><mn>0</mn></msub></mrow></math>, existe uma única solução <math id="eqn47" display="inline"><mrow><mi>y</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow></math>, que é a curva tal que <math id="eqn48" display="inline"><mrow><mi>y</mi><mo stretchy="false">(</mo><msub><mi>x</mi><mn>0</mn></msub><mo stretchy="false">)</mo><mo>=</mo><msub><mi>y</mi><mn>0</mn></msub></mrow></math> e com declive igual a <math id="eqn49" display="inline"><mrow><mo stretchy="false">(</mo><mi>x</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo><mo stretchy="false">(</mo><mi>x</mi><mo>−</mo><mn>3</mn><mo stretchy="false">)</mo><mo>−</mo><mi>y</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow></math> em qualquer valor de
<math id="eqn50" display="inline"><mrow><mi>x</mi></mrow></math>.
</p>
<p>
Os métodos de resolução numérica consistem em calcular o valor da
variável dependente <math id="eqn51" display="inline"><mrow><mi>y</mi></mrow></math> numa sequência discreta de pontos {<math id="eqn52" display="inline"><mrow><msub><mi>x</mi><mn>0</mn></msub></mrow></math>,
<math id="eqn53" display="inline"><mrow><msub><mi>x</mi><mn>1</mn></msub></mrow></math>, <math id="eqn54" display="inline"><mrow><msub><mi>x</mi><mn>2</mn></msub></mrow></math>, &hellip;, <math id="eqn55" display="inline"><mrow><msub><mi>x</mi><mi>n</mi></msub></mrow></math>}, usando alguma aproximação. O resultado
obtido aplicando um determinado método será o conjunto de pontos
{(<math id="eqn56" display="inline"><mrow><msub><mi>x</mi><mn>0</mn></msub></mrow></math>, <math id="eqn57" display="inline"><mrow><msub><mi>y</mi><mn>0</mn></msub></mrow></math>), (<math id="eqn58" display="inline"><mrow><msub><mi>x</mi><mn>1</mn></msub></mrow></math>, <math id="eqn59" display="inline"><mrow><msub><mi>y</mi><mn>1</mn></msub></mrow></math>), &hellip;, (<math id="eqn60" display="inline"><mrow><msub><mi>x</mi><mi>n</mi></msub></mrow></math>, <math id="eqn61" display="inline"><mrow><msub><mi>y</mi><mi>n</mi></msub></mrow></math>)}, que
aproximam o gráfico da função <math id="eqn62" display="inline"><mrow><mi>y</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow></math>. Nos métodos que usam incrementos
constantes, o intervalo [<math id="eqn63" display="inline"><mrow><msub><mi>x</mi><mn>0</mn></msub></mrow></math>, <math id="eqn64" display="inline"><mrow><msub><mi>x</mi><mi>n</mi></msub></mrow></math>] divide-se em <math id="eqn65" display="inline"><mrow><mi>n</mi></mrow></math> subintervalos
de comprimento <math id="eqn66" display="inline"><mrow><mi>h</mi><mo>=</mo><mo stretchy="false">(</mo><msub><mi>x</mi><mi>n</mi></msub><mo>−</mo><msub><mi>x</mi><mn>0</mn></msub><mo stretchy="false">)</mo><mo>/</mo><mi>n</mi></mrow></math>, de forma que cada valor na sequência
{<math id="eqn67" display="inline"><mrow><msub><mi>x</mi><mi>i</mi></msub></mrow></math>} é igual ao valor anterior mais <math id="eqn68" display="inline"><mrow><mi>h</mi></mrow></math>:
</p>
<div class="eqnalign" id="eq-3.11">
<div class="eqn">(3.11)</div>
<math id="eqn69" display="inline"><mrow><mo stretchy="false">{</mo><msub><mi>x</mi><mn>0</mn></msub><mo>,</mo><msub><mi>x</mi><mn>1</mn></msub><mo>=</mo><msub><mi>x</mi><mn>0</mn></msub><mo>+</mo><mi>h</mi><mo>,</mo><msub><mi>x</mi><mn>2</mn></msub><mo>=</mo><msub><mi>x</mi><mn>0</mn></msub><mo>+</mo><mn>2</mn><mi>h</mi><mo>,</mo><mi>…</mi><mo>,</mo><msub><mi>x</mi><mi>n</mi></msub><mo>=</mo><msub><mi>x</mi><mn>0</mn></msub><mo>+</mo><mi>n</mi><mi>h</mi><mo stretchy="false">}</mo></mrow></math>
</div>
<p>
Por exemplo, a Figura&nbsp;<a href="#fig-3.2">3.2</a> mostra a solução
da equação diferencial <math id="eqn70" display="inline"><mrow><mi>y</mi><mi>′</mi><mo>=</mo><mi>f</mi><mo stretchy="false">(</mo><mi>x</mi><mo>,</mo><mi>y</mi><mo stretchy="false">)</mo></mrow></math> com <math id="eqn71" display="inline"><mrow><mi>f</mi><mo>=</mo><mo stretchy="false">(</mo><mi>x</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo><mo stretchy="false">(</mo><mi>x</mi><mo>−</mo><mn>3</mn><mo stretchy="false">)</mo><mo>−</mo><mi>y</mi></mrow></math> e
condição inicial <math id="eqn72" display="inline"><mrow><mi>y</mi><mo stretchy="false">(</mo><mn>0</mn><mo stretchy="false">)</mo><mo>=</mo><mn>1</mn></mrow></math>, no intervalo <math id="eqn73" display="inline"><mrow><mn>0</mn><mo>≤</mo><mi>x</mi><mo>≤</mo><mn>4</mn></mrow></math>. Os cinco
pontos sobre a curva são a aproximação da função usando apenas 5
pontos com abcissas 0, 1, 2, 3 e 4.
</p>
<figure class="center" id="fig-3.2">
<img class="fig" src="img/aproximacao_discreta.png"
     alt="Aproximação de uma curva com 5 pontos"
     style="width:27em;max-width:100%;height:auto">
<figcaption><b>Figura 3.2:</b> Uma solução da equação <math id="eqn74" display="inline"><mrow><mi>y</mi><mi>′</mi><mo>=</mo><mo stretchy="false">(</mo><mi>x</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo><mo stretchy="false">(</mo><mi>x</mi><mo>−</mo><mn>3</mn><mo stretchy="false">)</mo><mo>−</mo><mi>y</mi></mrow></math>, e aproximação com 5 pontos.</figcaption>
</figure>
<p>
Cada ângulo <math id="eqn75" display="inline"><mrow><msub><mi>θ</mi><mrow><mi>i</mi><mo>,</mo><mi>j</mi></mrow></msub></mrow></math> na figura é a inclinação segmento entre os
pontos (<math id="eqn76" display="inline"><mrow><msub><mi>x</mi><mi>i</mi></msub></mrow></math>, <math id="eqn77" display="inline"><mrow><msub><mi>y</mi><mi>i</mi></msub></mrow></math>) e (<math id="eqn78" display="inline"><mrow><msub><mi>x</mi><mrow><mi>i</mi><mo>,</mo><mi>j</mi></mrow></msub></mrow></math>, <math id="eqn79" display="inline"><mrow><msub><mi>y</mi><mrow><mi>i</mi><mo>,</mo><mi>j</mi></mrow></msub></mrow></math>). A tangente do ângulo
<math id="eqn80" display="inline"><mrow><msub><mi>θ</mi><mrow><mi>i</mi><mo>,</mo><mi>j</mi></mrow></msub></mrow></math> (declive médio) é igual ao valor médio de <math id="eqn81" display="inline"><mrow><mi>f</mi><mo stretchy="false">(</mo><mi>x</mi><mo>,</mo><mi>y</mi><mo stretchy="false">)</mo></mrow></math> no
intervalo [<math id="eqn82" display="inline"><mrow><msub><mi>x</mi><mi>i</mi></msub></mrow></math>, <math id="eqn83" display="inline"><mrow><msub><mi>x</mi><mi>j</mi></msub></mrow></math>]. A partir das coordenadas (<math id="eqn84" display="inline"><mrow><msub><mi>x</mi><mi>i</mi></msub></mrow></math>, <math id="eqn85" display="inline"><mrow><msub><mi>y</mi><mi>i</mi></msub></mrow></math>) de
um dos pontos, o declive médio <math id="eqn86" display="inline"><mrow><msub><mover><mrow><mi>f</mi></mrow><mo stretchy="true">¯</mo></mover><mrow><mi>i</mi><mo>,</mo><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub></mrow></math> permite calcular as
coordenadas do ponto seguinte:
</p>
<div class="eqnalign" id="eq-3.12">
<div class="eqn">(3.12)</div>
<span class="boxed">
<math id="eqn87" display="inline"><mrow><msub><mi>x</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>=</mo><msub><mi>x</mi><mi>i</mi></msub><mo>+</mo><mi>h</mi><mspace width="2em" /><msub><mi>y</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>=</mo><msub><mi>y</mi><mi>i</mi></msub><mo>+</mo><mi>h</mi><mspace width="0.167em" /><msub><mover><mrow><mi>f</mi></mrow><mo stretchy="true">¯</mo></mover><mrow><mi>i</mi><mo>,</mo><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub></mrow></math>
</span>
</div>
<p>
Usando estas <b>relações de recorrência</b> de forma iterativa,
consegue-se obter as coordenadas de todos os pontos (<math id="eqn88" display="inline"><mrow><msub><mi>x</mi><mi>i</mi></msub></mrow></math>, <math id="eqn89" display="inline"><mrow><msub><mi>y</mi><mi>i</mi></msub></mrow></math>),
começando com os valores iniciais dados (<math id="eqn90" display="inline"><mrow><msub><mi>x</mi><mn>0</mn></msub></mrow></math>, <math id="eqn91" display="inline"><mrow><msub><mi>y</mi><mn>0</mn></msub></mrow></math>).
</p>
<p>
Se os declives médios <math id="eqn92" display="inline"><mrow><msub><mover><mrow><mi>f</mi></mrow><mo stretchy="true">¯</mo></mover><mrow><mi>i</mi><mo>,</mo><mi>j</mi></mrow></msub></mrow></math> pudessem ser calculados de forma
exata, os resultados obtidos seriam exatos. No entanto, para calcular
o valor médio de <math id="eqn93" display="inline"><mrow><mi>f</mi><mo stretchy="false">(</mo><mi>x</mi><mo>,</mo><mi>y</mi><mo stretchy="false">)</mo></mrow></math> num intervalo seria necessário conhecer a
função <math id="eqn94" display="inline"><mrow><mi>y</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow></math>, mas quando se usam métodos numéricos é porque não
existem métodos para encontrar a expressão analítica dessa função. Os
diferentes métodos numéricos que existem para resolver equações
diferenciais correspondem a diferentes esquemas para estimar o valor
médio aproximado da função <math id="eqn95" display="inline"><mrow><mi>f</mi><mo stretchy="false">(</mo><mi>x</mi><mo>,</mo><mi>y</mi><mo stretchy="false">)</mo></mrow></math> em cada intervalo.
</p>
<h3 id="sec-3.2.1">3.2.1. Método de Euler</h3>
<p>
No método de Euler admite-se que <math id="eqn96" display="inline"><mrow><msub><mover><mrow><mi>f</mi></mrow><mo stretchy="true">¯</mo></mover><mrow><mi>i</mi><mo>,</mo><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub></mrow></math> &asymp;
<math id="eqn97" display="inline"><mrow><mi>f</mi><mo stretchy="false">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo>,</mo><msub><mi>y</mi><mi>i</mi></msub><mo stretchy="false">)</mo></mrow></math>. Ou seja, o valor médio de <math id="eqn98" display="inline"><mrow><mi>f</mi></mrow></math> em cada intervalo é
aproximado pelo valor de <math id="eqn99" display="inline"><mrow><mi>f</mi><mo stretchy="false">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo>,</mo><msub><mi>y</mi><mi>i</mi></msub><mo stretchy="false">)</mo></mrow></math> no ponto inicial do
intervalo. Realizando os cálculos no Maxima para o caso considerado
acima, em que <math id="eqn100" display="inline"><mrow><mi>f</mi><mo stretchy="false">(</mo><mi>x</mi><mo>,</mo><mi>y</mi><mo stretchy="false">)</mo><mo>=</mo><mo stretchy="false">(</mo><mi>x</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo><mo stretchy="false">(</mo><mi>x</mi><mo>−</mo><mn>3</mn><mo stretchy="false">)</mo><mo>−</mo><mi>y</mi></mrow></math> e com condição inicial <math id="eqn101" display="inline"><mrow><mi>y</mi><mo stretchy="false">(</mo><mn>0</mn><mo stretchy="false">)</mo></mrow></math> =
1, pode usar-se uma lista <math id="eqn102" display="inline"><mrow><mi>p</mi></mrow></math> para armazenar as coordenadas dos
pontos; inicia-se a lista com o ponto inicial e define-se a função
<math id="eqn103" display="inline"><mrow><mi>f</mi><mo stretchy="false">(</mo><mi>x</mi><mo>,</mo><mi>y</mi><mo stretchy="false">)</mo></mrow></math> dada:
</p>
<pre>
<span class="maxp">(%i1)</span> <span class="maxi">p: [[0, 1]]$</span><br>
<span class="maxp">(%i2)</span> <span class="maxi">f(x,y) := (x-1)*(x-3)-y$</span>
</pre>
<p>
Os quatro pontos seguintes na sequência são acrescentados à lista <math id="eqn104" display="inline"><mrow><mi>p</mi></mrow></math>,
usando um ciclo e as relações de
recorrência&nbsp;(<a href="#eq-3.12">3.12</a>) com <math id="eqn105" display="inline"><mrow><mi>h</mi><mo>=</mo><mn>1</mn></mrow></math>:
</p>
<pre>
<span class="maxp">(%i3)</span> <span class="maxi">for i thru 4 do (</span><br>
         <span class="maxi">[xi,yi]: last(p),</span><br>
         <span class="maxi">p: endcons ([xi + 1, yi + f(xi, yi)], p))$</span><br>
<span class="maxp">(%i4)</span> <span class="maxi">p;</span><br>
(%o4)  [[0, 1], [1, 3], [2, 0], [3, −1], [4, 0]]
</pre>
<p>
O gráfico na Figura&nbsp;<a href="#fig-3.3">3.3</a> mostra o resultado
obtido (segmentos de reta e pontos), comparando-o com a solução exata
(curva contínua). Observa-se que a solução obtida com o método de
Euler não é uma aproximação muito boa. No entanto, reduzindo o valor
dos incrementos em <math id="eqn106" display="inline"><mrow><mi>x</mi></mrow></math> de <math id="eqn107" display="inline"><mrow><mi>h</mi><mo>=</mo><mn>1</mn></mrow></math> para um valor menor, deverá ser
possível obter uma aproximação melhor. É conveniente reduzir
gradualmente o valor de <math id="eqn108" display="inline"><mrow><mi>h</mi></mrow></math> e comparar as soluções com as obtidas com
valores maiores de <math id="eqn109" display="inline"><mrow><mi>h</mi></mrow></math>; se a solução obtida não variar
significativamente quando <math id="eqn110" display="inline"><mrow><mi>h</mi></mrow></math> é reduzido, essa solução deverá ser uma
boa aproximação da solução verdadeira.
</p>
<figure class="center" id="fig-3.3">
<img class="fig" src="img/metodo_de_Euler.png"
     alt="Método de Euler" style="width:27em;max-width:100%;height:auto">
<figcaption><b>Figura 3.3:</b> Método de Euler.</figcaption>
</figure>
<br>
<div class="example" id="ex-3.1">
<span class="example_heading">Exemplo 3.1</span>
<p>
A carga armazenada num condensador ligado a uma pilha e a uma
resistência é uma função <math id="eqn111" display="inline"><mrow><mi>Q</mi></mrow></math> que depende do tempo <math id="eqn112" display="inline"><mrow><mi>t</mi></mrow></math> e verifica a
seguinte equação diferencial
</p>
<div class="eqnalign">
<math id="eqn113" display="inline"><mrow><mstyle displaystyle="true" scriptlevel="0"><mfrac><mrow><mrow><mi mathvariant="normal">d</mi></mrow><mi>Q</mi></mrow><mrow><mrow><mi mathvariant="normal">d</mi></mrow><mi>t</mi></mrow></mfrac></mstyle><mo>=</mo><mn>1.25</mn><mo>−</mo><mi>Q</mi></mrow></math>
</div>
<p>
No instante inicial, <math id="eqn114" display="inline"><mrow><mi>t</mi><mo>=</mo><mn>0</mn></mrow></math>, a carga no condensador é nula. Usando o
método de Euler, encontre uma sequência que aproxime <math id="eqn115" display="inline"><mrow><mi>Q</mi><mo stretchy="false">(</mo><mi>t</mi><mo stretchy="false">)</mo></mrow></math> no
intervalo <math id="eqn116" display="inline"><mrow><mn>0</mn><mo>≤</mo><mi>t</mi><mo>≤</mo><mn>6</mn></mrow></math>.
</p>
</div>
<p>
<b>Resolução</b>. Neste caso, a função <math id="eqn117" display="inline"><mrow><mi>f</mi></mrow></math> que define a derivada não
depende da variável independente <math id="eqn118" display="inline"><mrow><mi>t</mi></mrow></math>. Os valores iniciais e a função
que define a derivada são:
</p>
<pre>
<span class="maxp">(%i5)</span> <span class="maxi">p: [[0, 0]]$</span><br>
<span class="maxp">(%i6)</span> <span class="maxi">f(Q) := 1.25 - Q$</span>
</pre>
<p>
Começando com incrementos de tempo <math id="eqn119" display="inline"><mrow><mi>h</mi><mo>=</mo><mn>0.1</mn></mrow></math>, são necessárias 60
iterações para terminar em <math id="eqn120" display="inline"><mrow><mi>t</mi><mo>=</mo><mn>6</mn></mrow></math>.
</p>
<pre>
<span class="maxp">(%i7)</span> <span class="maxi">for i thru 60 do (</span><br>
         <span class="maxi">[t0, Q0]: last(p),</span><br>
         <span class="maxi">p: endcons ([t0 + 0.1, Q0 + 0.1*f(Q0)], p)</span>
      <span class="maxi">)$</span>
</pre>
<p>
O último ponto na lista <math id="eqn121" display="inline"><mrow><mi>p</mi></mrow></math> é:
</p>
<pre>
<span class="maxp">(%i8)</span> <span class="maxi">last(p);</span><br>
(%o8)  [5.999999999999995, 1.247753737125107]
</pre>
<p>
Convém repetir o processo, com um valor menor de <math id="eqn122" display="inline"><mrow><mi>h</mi></mrow></math>, por exemplo 0.01
e comparar o novo resultado com o resultado anterior:
</p>
<pre>
<span class="maxp">(%i9)</span> <span class="maxi">q: [[0,0]]$</span><br>
<span class="maxp">(%i10)</span> <span class="maxi">for i thru 600 do (</span><br>
          <span class="maxi">[t0,Q0]: last(q),</span><br>
          <span class="maxi">q: endcons ([t0 + 0.01, Q0 + 0.01*f(Q0)], q)</span><br>
       <span class="maxi">)$</span><br>
<span class="maxp">(%i11)</span> <span class="maxi">last(q);</span><br>
(%o11)  [5.9999999999999165, 1.246993738385861]
</pre>
<p>
A pesar de que o resultado final coincide em 4 algarismos
significativos nos dois casos, é interessante comparar as duas
sequências completas. As duas soluções obtidas com <math id="eqn123" display="inline"><mrow><mi>h</mi><mo>=</mo><mn>0.1</mn></mrow></math> e <math id="eqn124" display="inline"><mrow><mi>h</mi><mo>=</mo><mn>0.01</mn></mrow></math>
estão armazenadas nas listas <math id="eqn125" display="inline"><mrow><mi>p</mi></mrow></math> e <math id="eqn126" display="inline"><mrow><mi>q</mi></mrow></math> e podem ser representadas num
gráfico. A Figura&nbsp;<a href="#fig-3.4">3.4</a> mostra que, a pesar
de os resultados obtidos para <math id="eqn127" display="inline"><mrow><mi>t</mi></mrow></math> = 6 serem quase idênticos nos dois
casos, há uma discrepância entre as duas soluções obtidas, mais
visível no intervalo <math id="eqn128" display="inline"><mrow><mn>0.5</mn><mo><</mo><mi>t</mi><mo><</mo><mn>3.5</mn></mrow></math>. No entanto, como essa
discrepância não é muito grande, espera-se que a solução com <math id="eqn129" display="inline"><mrow><mi>h</mi><mo>=</mo><mn>0.01</mn></mrow></math>
já esteja bastante próxima da solução verdadeira. O gráfico foi feito
com o seguinte comando
</p>
<pre>
<span class="maxp">(%i12)</span> <span class="maxi">plot2d ([[discrete, p], [discrete, q]], [xlabel, "t"], [ylabel, "Q"],</span><br>
       <span class="maxi">[legend, "h=0.1", "h=0.01"])$</span>
</pre>
<figure class="center" id="fig-3.4">
<img class="fig" src="img/carga_condensador.png"
     alt="Carga num condensador em função do tempo"
     style="width:32em;max-width:100%;height:auto">
<figcaption>
<b>Figura 3.4:</b> Soluções obtidas pelo método de Euler.
</figcaption>
</figure>
<h3 id="sec-3.2.2">3.2.2. Método de Euler melhorado</h3>
<p>
A maior discrepância entre a sequência de pontos que aproximam a
solução exata <math id="eqn130" display="inline"><mrow><mi>y</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow></math> na figura&nbsp;<a href="#fig-3.2">3.2</a> e a
sequência obtida usando o método de Euler, apresentada na
figura&nbsp;<a href="#fig-3.3">3.3</a>, é no segundo ponto, (<math id="eqn131" display="inline"><mrow><msub><mi>x</mi><mn>1</mn></msub></mrow></math>,
<math id="eqn132" display="inline"><mrow><msub><mi>y</mi><mn>1</mn></msub></mrow></math>). O valor médio do declive no primeiro intervalo, que era
aproximadamente igual a zero, no método de Euler foi substituído por
2, que é o declive no ponto inicial (<math id="eqn133" display="inline"><mrow><msub><mi>x</mi><mn>0</mn></msub></mrow></math>, <math id="eqn134" display="inline"><mrow><msub><mi>y</mi><mn>0</mn></msub></mrow></math>). A
figura&nbsp;<a href="#fig-3.2">3.2</a> mostra que, a pesar de que os
dois primeiros valores da função, <math id="eqn135" display="inline"><mrow><msub><mi>y</mi><mn>0</mn></msub></mrow></math> e <math id="eqn136" display="inline"><mrow><msub><mi>y</mi><mn>1</mn></msub></mrow></math>, são iguais, o declive
<math id="eqn137" display="inline"><mrow><mi>f</mi><mo stretchy="false">(</mo><mi>x</mi><mo>,</mo><mi>y</mi><mo stretchy="false">)</mo></mrow></math> muda de um valor positivo em <math id="eqn138" display="inline"><mrow><msub><mi>x</mi><mn>0</mn></msub><mo>=</mo><mn>0</mn></mrow></math> para um valor negativo
em <math id="eqn139" display="inline"><mrow><msub><mi>x</mi><mn>1</mn></msub><mo>=</mo><mn>1</mn></mrow></math>. No método de Euler usou-se o declive em <math id="eqn140" display="inline"><mrow><msub><mi>x</mi><mn>0</mn></msub></mrow></math> como valor
médio o valor do declive nesse intervalo. Se o valor médio do declive
fosse aproximado pela média entre os dois declives em <math id="eqn141" display="inline"><mrow><msub><mi>x</mi><mn>0</mn></msub></mrow></math> e <math id="eqn142" display="inline"><mrow><msub><mi>x</mi><mn>1</mn></msub></mrow></math>, o
resultado seria muito melhor.
</p>
<p>
O método de Euler melhorado consiste em admitir que o declive médio
<math id="eqn143" display="inline"><mrow><msub><mover><mrow><mi>f</mi></mrow><mo stretchy="true">¯</mo></mover><mrow><mi>i</mi><mo>,</mo><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub></mrow></math> é igual à média entre os declives no ponto inicial
(<math id="eqn144" display="inline"><mrow><msub><mi>x</mi><mi>i</mi></msub></mrow></math>, <math id="eqn145" display="inline"><mrow><msub><mi>y</mi><mi>i</mi></msub></mrow></math>) e no ponto final (<math id="eqn146" display="inline"><mrow><msub><mi>x</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub></mrow></math>, <math id="eqn147" display="inline"><mrow><msub><mi>y</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub></mrow></math>); ou seja,
</p>
<div class="eqn" id="eq-3.13">(3.13)</div>
<math id="eqn148" display="block"><mrow><mrow><menclose notation="box"><mrow><msub><mover><mrow><mi>f</mi></mrow><mo stretchy="true">¯</mo></mover><mrow><mi>i</mi><mo>,</mo><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>≈</mo><mstyle displaystyle="true" scriptlevel="0"><mfrac><mrow><mi>f</mi><mo stretchy="false">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo>,</mo><msub><mi>y</mi><mi>i</mi></msub><mo stretchy="false">)</mo><mo>+</mo><mi>f</mi><mo stretchy="false">(</mo><msub><mi>x</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>,</mo><msub><mi>y</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub><mo stretchy="false">)</mo></mrow><mrow><mn>2</mn></mrow></mfrac></mstyle></mrow></menclose></mrow></mrow></math>
<p>
O problema com esta equação é que para poder-se calcular
<math id="eqn149" display="inline"><mrow><mi>f</mi><mo stretchy="false">(</mo><msub><mi>x</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>,</mo><msub><mi>y</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub><mo stretchy="false">)</mo></mrow></math> seria necessário saber o valor de <math id="eqn150" display="inline"><mrow><msub><mi>y</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub></mrow></math>, mas
esse valor é desconhecido enquanto a solução da equação não for
conhecida. É possível fazer uma estimativa inicial do valor que
<math id="eqn151" display="inline"><mrow><msub><mi>y</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub></mrow></math> poderá ter e a seguir melhorar essa estimativa. Uma primeira
estimativa muito rudimentar consiste em dizer que <math id="eqn152" display="inline"><mrow><msub><mi>y</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub></mrow></math> é igual a
<math id="eqn153" display="inline"><mrow><msub><mi>y</mi><mi>i</mi></msub></mrow></math>.
</p>
<p>
Com essa abordagem, a resolução da mesma equação <math id="eqn154" display="inline"><mrow><mi>y</mi><mi>′</mi><mo>=</mo><mo stretchy="false">(</mo><mi>x</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo><mo stretchy="false">(</mo><mi>x</mi><mo>−</mo><mn>3</mn><mo stretchy="false">)</mo><mo>−</mo><mi>y</mi></mrow></math>
considerada na secção anterior, com valor inicial <math id="eqn155" display="inline"><mrow><mi>y</mi><mo stretchy="false">(</mo><mn>0</mn><mo stretchy="false">)</mo><mo>=</mo><mn>1</mn></mrow></math> e com 5
pontos no intervalo 0 &le; <math id="eqn156" display="inline"><mrow><mi>x</mi><mi>&</mi><mi>l</mi><mi>e</mi><mi>;</mi><mn>4</mn></mrow></math>, pode ser feita assim: começa-se
por iniciar a lista de pontos e definir a função que calcula o declive
</p>
<pre>
<span class="maxp">(%i13)</span> <span class="maxi">p: [[0,,1]]$</span><br>
<span class="maxp">(%i14)</span> <span class="maxi">f(x,y) := (x-1)*(x-3)-y$</span>
</pre>
<p>
Foi necessário definir novamente a função <math id="eqn157" display="inline"><mrow><mi>f</mi><mo stretchy="false">(</mo><mi>x</mi><mo>,</mo><mi>y</mi><mo stretchy="false">)</mo></mrow></math>, já que a definição
usada na secção anterior foi logo substituída pela função <math id="eqn158" display="inline"><mrow><mi>f</mi><mo stretchy="false">(</mo><mi>Q</mi><mo stretchy="false">)</mo></mrow></math> do
exemplo&nbsp;<a href="#ex-3.1">3.1</a>. Basta repetir as 4 iterações
mas usando agora a expressão&nbsp;<a href="#eq-3.13">3.13</a> nas
relações de recorrência&nbsp;<a href="#eq-3.12">3.12</a>
</p>
<pre>
<span class="maxp">(%i15)</span> <span class="maxi">for i thru 4 do (</span><br>
           <span class="maxi">[xi,yi]: last(p),</span><br>
           <span class="maxi">p: endcons ([xi+1, yi + (f (xi, yi) + f (xi+1, yi))/2], p)</span><br>
       <span class="maxi">)$</span><br>
<span class="maxp">(%i16)</span> <span class="maxi">float (p);</span><br>
(%o16) [[0.0, 1.0], [1.0, 1.5], [2.0, -0.5], [3.0, -0.5], [4.0, 1.5]]
</pre>
<p>
A figura&nbsp;<a href="#fig-3.5">3.5</a> mostra a sequência de pontos
obtida, juntamente com a solução exata (curva contínua na figura). O
resultado é muito melhor que o resultado obtido com o método de Euler.
</p>
<figure class="center" id="fig-3.5">
<img class="fig" src="img/metodo_de_Euler2.png" alt="Método de Euler melhorado"
     style="width:21.357em;max-width:100%;height:auto">
<figcaption>
<b>Figura 3.5:</b> Solução exata e solução obtida com o método usado
em <span class="maxp">(%i15)</span>.
</figcaption>
</figure>
<p>
O resultado obtido com <span class="maxp">(%i15)</span> pode ser
melhorado se a estimativa inicial <math id="eqn159" display="inline"><mrow><msub><mi>y</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>=</mo><msub><mi>y</mi><mi>i</mi></msub></mrow></math> for melhorada com o
resultado obtido a partir dessa primeira estimativa.  Se designarmos
<math id="eqn160" display="inline"><mrow><msub><mi>y</mi><mrow><mn>1</mn><mo>,</mo><mn>0</mn></mrow></msub></mrow></math> à primeira estimativa do valor de <math id="eqn161" display="inline"><mrow><msub><mi>y</mi><mn>1</mn></msub></mrow></math>, então
<math id="eqn162" display="inline"><mrow><msub><mi>y</mi><mrow><mn>1</mn><mo>,</mo><mn>0</mn></mrow></msub><mo>=</mo><msub><mi>y</mi><mn>0</mn></msub></mrow></math>, como foi usado em <span class="maxp">(%i15)</span>. A
segunda estimativa é: <math id="eqn163" display="inline"><mrow><msub><mi>y</mi><mrow><mn>1</mn><mo>,</mo><mn>1</mn></mrow></msub><mo>=</mo><msub><mi>y</mi><mn>0</mn></msub><mo>+</mo><mi>h</mi><mspace width="0.167em" /><mi>f</mi><mo stretchy="false">(</mo><msub><mi>x</mi><mn>0</mn></msub><mo>,</mo><msub><mi>y</mi><mrow><mn>1</mn><mo>,</mo><mn>0</mn></mrow></msub><mo stretchy="false">)</mo></mrow></math>. Esse valor
estará mais próximo do valor real de <math id="eqn164" display="inline"><mrow><msub><mi>y</mi><mn>1</mn></msub></mrow></math> do que a estimativa inicial
<math id="eqn165" display="inline"><mrow><msub><mi>y</mi><mrow><mn>1</mn><mo>,</mo><mn>0</mn></mrow></msub></mrow></math>; assim sendo, espera-se que a sequência
<math id="eqn166" display="inline"><mrow><msub><mi>y</mi><mrow><mn>1</mn><mo>,</mo><mi>n</mi></mrow></msub><mo>=</mo><msub><mi>y</mi><mn>0</mn></msub><mo>+</mo><mi>h</mi><mspace width="0.167em" /><mi>f</mi><mo stretchy="false">(</mo><msub><mi>x</mi><mn>0</mn></msub><mo>,</mo><msub><mi>y</mi><mrow><mn>1</mn><mo>,</mo><mi>n</mi><mo>−</mo><mn>1</mn></mrow></msub><mo stretchy="false">)</mo></mrow></math> se aproxime do valor real de
<math id="eqn167" display="inline"><mrow><msub><mi>y</mi><mn>1</mn></msub></mrow></math>. Calculam-se alguns termos dessa sequência, até
<math id="eqn168" display="inline"><mrow><mo stretchy="false">|</mo><msub><mi>y</mi><mrow><mn>1</mn><mo>,</mo><mi>n</mi></mrow></msub><mo>−</mo><msub><mi>y</mi><mrow><mn>1</mn><mo>,</mo><mi>n</mi><mo>−</mo><mn>1</mn></mrow></msub><mo stretchy="false">|</mo></mrow></math> ser menor que uma precisão desejada. Nesse
momento usa-se <math id="eqn169" display="inline"><mrow><msub><mi>y</mi><mn>1</mn></msub><mo>=</mo><msub><mi>y</mi><mrow><mn>1</mn><mo>,</mo><mi>n</mi></mrow></msub></mrow></math> como valor inicial para o seguinte
intervalo e o processo repete-se iterativamente em todo o intervalo de
<math id="eqn170" display="inline"><mrow><mi>x</mi></mrow></math>.
</p>
<p>
No caso do mesmo problema resolvido
em <span class="maxp">(%i15)</span>, com <math id="eqn171" display="inline"><mrow><mi>h</mi><mo>=</mo><mn>1</mn></mrow></math> e usando precisão de
0.0001 para <math id="eqn172" display="inline"><mrow><mo stretchy="false">|</mo><msub><mi>y</mi><mrow><mn>1</mn><mo>,</mo><mi>n</mi></mrow></msub><mo>−</mo><msub><mi>y</mi><mrow><mn>1</mn><mo>,</mo><mi>n</mi><mo>−</mo><mn>1</mn></mrow></msub><mo stretchy="false">|</mo></mrow></math>, o método pode ser implementado
assim:
</p>
<pre>
<span class="maxp">(%i17)</span> <span class="maxi">f(x,y) := (x-1)*(x-3)-y$</span><br>
<span class="maxp">(%i18)</span> <span class="maxi">p: [[0.0, 1.0]]$</span><br>
<span class="maxp">(%i19)</span> <span class="maxi">for i thru 4 do (</span><br>
           <span class="maxi">[xi,yi]: last(p),</span><br>
           <span class="maxi">y1: yi,</span><br>
           <span class="maxi">y2: yi + (f(xi,yi)+f(xi+1,y1))/2,</span><br>
           <span class="maxi">while abs(y1-y2) > 0.0001 do (</span><br>
                 <span class="maxi">y1: y2, y2: yi + (f(xi,yi)+f(xi+1,y1))/2),</span><br>
           <span class="maxi">p: endcons ([xi+1, y2], p)</span><br>
       <span class="maxi">)$</span><br>
<span class="maxp">(%i20)</span> <span class="maxi">p;</span><br>
(%o20) [[0.0, 1.0], [1.0, 1.33331298828125], [2.0, 0.11112297885119915],<br>
                    [3.0, - 0.2962674737252655], [4.0, 0.9012259028472571]]   
</pre>
<p>
Definiu-se novamente a função <math id="eqn173" display="inline"><mrow><mi>f</mi></mrow></math>, acrescentando o
comando <span class="concept">float</span>, para evitar obter fracções
com numeradores e denominadores muito grandes; nos exemplos anteriores
foram feitos menos cálculos e, por isso, não produziram frações com
números grandes. O resultado (ver
figura&nbsp;<a href="#fig-3.6">3.6</a>) mostra que a solução obtida
está mais próxima da verdadeira solução do que as aproximações
apresentadas nas figuras <a href="#fig-3.3">3.3</a>
e <a href="#fig-3.5">3.5</a>.
</p>
<figure class="center" id="fig-3.6">
<img class="fig" src="img/metodo_de_Euler_melhorado.png"
     style="width:21.357em;max-width:100%;height:auto"
     alt="Metodo de Euler melhorado">
<figcaption>
<b>Figura 3.6:</b> Solução exata e solução obtida com o método de
Euler melhorado.
</figcaption>
</figure>
<p>
A pesar de se ter usado uma precisão de 0.0001, não se pode garantir
que a solução obtida esteja dentro dessa precisão em relação á solução
real, já que a equação&nbsp;<a href="#eq-3.13">3.13</a> é apenas uma
aproximação e não o valor médio real da derivada. Para melhorar essa
aproximação, em vez de se obter a média do declive em dois pontos será
necessário fazer uma média em vários pontos do intervalo em questão,
com diferentes pesos que podem ser definidos de forma a minimizar o
erro. Existem muitos métodos diferentes que usam esse esquema; o mais
popular é o que será descrito na seguinte secção.
</p>
<h3 id="sec-3.2.3">3.2.3. Método de Runge-Kutta de quarta ordem</h3>
<p>
Neste método o valor médio do declive <math id="eqn174" display="inline"><mrow><msub><mover><mrow><mi>f</mi></mrow><mo stretchy="true">¯</mo></mover><mrow><mi>i</mi><mo>,</mo><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub></mrow></math> obtém-se a
partir da média dos declives em 4 pontos diferentes, com pesos
diferentes (figura <a href="#fig-3.7">3.7</a>).
</p>
<figure class="center" id="fig-3.7">
<img class="fig" src="img/metodo_de_Runge-Kutta.png"
     style="width:22.407em;max-width:100%;height:auto"
     alt="Metodo de Runge-Kutta de quarta ordem">
<figcaption>
<b>Figura 3.7:</b> Declives usados no método de Runge-Kutta de quarta
ordem.
</figcaption>
</figure>
<p>
Começa-se por calcular o declive no ponto inicial do intervalo, tal
como no método de Euler:
</p>
<div class="eqn" id="eq-3.14">(3.14)</div>
<math id="eqn175" display="block"><mrow><mrow><msub><mi>d</mi><mn>1</mn></msub><mo>=</mo><mi>f</mi><mo stretchy="false">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo>,</mo><msub><mi>y</mi><mi>i</mi></msub><mo stretchy="false">)</mo></mrow></mrow></math>
<p>
a seguir, realiza-se um deslocamento na direção desse declive,
avançando-se uma distância <math id="eqn176" display="inline"><mrow><mi>h</mi><mo>/</mo><mn>2</mn></mrow></math> no eixo das abcissas, até um ponto 2
(ver figura&nbsp;<a href="#fig-3.7">3.7</a>). Nesse ponto 2,
calcula-se um segundo valor do declive
</p>
<div class="eqn" id="eq-3.15">(3.15)</div>
<math id="eqn177" display="block"><mrow><mrow><msub><mi>d</mi><mn>2</mn></msub><mo>=</mo><mi>f</mi><mo stretchy="false">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo>+</mo><mi>h</mi><mo>/</mo><mn>2</mn><mo>,</mo><msub><mi>y</mi><mi>i</mi></msub><mo>+</mo><mo stretchy="false">(</mo><mi>h</mi><mo>/</mo><mn>2</mn><mo stretchy="false">)</mo><msub><mi>d</mi><mn>1</mn></msub><mo stretchy="false">)</mo></mrow></mrow></math>
<p>
Esse novo valor do declive é usado novamente, para realizar outro
deslocamento a partir do ponto inicial, avançando <math id="eqn178" display="inline"><mrow><mi>h</mi><mo>/</mo><mn>2</mn></mrow></math> na direção do
eixo das abcissas, até um outro ponto 3, onde é calculado um terceiro
valor do declive
</p>
<div class="eqn" id="eq-3.16">(3.16)</div>
<math id="eqn179" display="block"><mrow><mrow><msub><mi>d</mi><mn>3</mn></msub><mo>=</mo><mi>f</mi><mo stretchy="false">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo>+</mo><mi>h</mi><mo>/</mo><mn>2</mn><mo>,</mo><msub><mi>y</mi><mi>i</mi></msub><mo>+</mo><mo stretchy="false">(</mo><mi>h</mi><mo>/</mo><mn>2</mn><mo stretchy="false">)</mo><msub><mi>d</mi><mn>2</mn></msub><mo stretchy="false">)</mo></mrow></mrow></math>
<p>
seguindo a direção desse declive <math id="eqn180" display="inline"><mrow><msub><mi>d</mi><mn>3</mn></msub></mrow></math>, realiza-se um terceiro
deslocamento, a partir do ponto inicial, desta vez avançando uma
distância <math id="eqn181" display="inline"><mrow><mi>h</mi></mrow></math> no sentido do eixo das abcissas, para chegar até um
ponto 4, onde se calcula um quarto valor do declive
</p>
<div class="eqn" id="eq-3.17">(3.17)</div>
<math id="eqn182" display="block"><mrow><mrow><msub><mi>d</mi><mn>4</mn></msub><mo>=</mo><mi>f</mi><mo stretchy="false">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo>+</mo><mi>h</mi><mo>,</mo><msub><mi>y</mi><mi>i</mi></msub><mo>+</mo><mi>h</mi><mspace width="0.167em" /><msub><mi>d</mi><mn>3</mn></msub><mo stretchy="false">)</mo></mrow></mrow></math>
<p>
Pode mostrar-se que para minimizar o erro cometido, o valor médio do
declive deve ser aproximado pela seguinte combinação linear dos quatro
declives calculados:
</p>
<div class="eqn" id="eq-3.18">(3.18)</div>
<math id="eqn183" display="block"><mrow><mrow><msub><mover><mrow><mi>f</mi></mrow><mo stretchy="true">¯</mo></mover><mrow><mi>i</mi><mo>,</mo><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>≈</mo><mfrac><mrow><mn>1</mn></mrow><mrow><mn>6</mn></mrow></mfrac><mo stretchy="false">(</mo><msub><mi>d</mi><mn>1</mn></msub><mo>+</mo><mn>2</mn><msub><mi>d</mi><mn>2</mn></msub><mo>+</mo><mn>2</mn><msub><mi>d</mi><mn>3</mn></msub><mo>+</mo><msub><mi>d</mi><mn>4</mn></msub><mo stretchy="false">)</mo></mrow></mrow></math>
<p>
no exemplo da figura <a href="#fig-3.7">3.7</a>, esse valor médio da
derivada desloca o ponto inicial até o ponto 4, que está bastante
próximo da solução exata da equação.
</p>
<p>
Para aplicar este método à mesma equação <math id="eqn184" display="inline"><mrow><mi>y</mi><mi>′</mi><mo>=</mo><mo stretchy="false">(</mo><mi>x</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo><mo stretchy="false">(</mo><mi>x</mi><mo>−</mo><mn>3</mn><mo stretchy="false">)</mo><mo>−</mo><mi>y</mi></mrow></math>
considerada nas secções anteriores, com valor inicial <math id="eqn185" display="inline"><mrow><mi>y</mi><mo stretchy="false">(</mo><mn>0</mn><mo stretchy="false">)</mo></mrow></math> = 1 e com
5 pontos no intervalo <math id="eqn186" display="inline"><mrow><mn>0</mn><mi>&</mi><mi>l</mi><mi>e</mi><mi>;</mi><mi>x</mi><mi>&</mi><mi>l</mi><mi>e</mi><mi>;</mi><mn>4</mn></mrow></math>, inicia-se a lista de pontos (a
função que define o declive em cada ponto é a função <math id="eqn187" display="inline"><mrow><mi>f</mi></mrow></math> que já está
definida)
</p>
<pre>
<span class="maxp">(%i21)</span> <span class="maxi">p: [[0.0, 1.0]]$</span><br>
<span class="maxp">(%i22)</span> <span class="maxi">h: 1.0$</span>
</pre>
<p>
Neste caso foi dado explicitamente o valor do comprimento dos
intervalos, para que as expressões seguintes sejam mais claras.
</p>
<p>
A seguir realizam-se as 4 iterações necessárias para chegar até o
ponto <math id="eqn188" display="inline"><mrow><mi>x</mi><mo>=</mo><mn>4</mn></mrow></math>. Em cada iteração calculam-se os quatro declives <math id="eqn189" display="inline"><mrow><msub><mi>d</mi><mn>1</mn></msub></mrow></math>,
<math id="eqn190" display="inline"><mrow><msub><mi>d</mi><mn>2</mn></msub></mrow></math>, <math id="eqn191" display="inline"><mrow><msub><mi>d</mi><mn>3</mn></msub></mrow></math> e <math id="eqn192" display="inline"><mrow><msub><mi>d</mi><mn>4</mn></msub></mrow></math> e a média com os pesos dados na
equação&nbsp;<a href="#eq-3.18">3.18</a>.
</p>
<pre>
<span class="maxp">(%i23)</span> <span class="maxi">for i thru 4 do (</span><br>
           <span class="maxi">[xi,yi]: last(p),</span><br>
           <span class="maxi">d1: f(xi, yi),</span><br>
           <span class="maxi">d2: f(xi+h/2, yi+(h/2)*d1),</span><br>
           <span class="maxi">d3: f(xi+h/2, yi+(h/2)*d2),</span><br>
           <span class="maxi">d4: f(xi+h, yi+h*d3),</span><br>
           <span class="maxi">p: endcons ([xi+h, yi + h*(d1+2*d2+2*d3+d4)/6], p)</span><br>
        <span class="maxi">)$</span><br>
<span class="maxp">(%i24)</span> <span class="maxi">p;</span><br>
(%o24) [[0.0, 1.0], [1.0, 1.0208333333333333], [2.0, -0.09635416666666652],<br>
        [3.0, -0.3902994791666666], [4.0, 0.8744710286458335]]
</pre>
<p>
A figura&nbsp;<a href="#fig-3.8">3.8</a> mostra a sequência de pontos
obtida, juntamente com a solução exata (curva contínua na figura). O
resultado é bastante bom, a pesar do valor tão elevado que foi usado
para os incrementos da variável <math id="eqn193" display="inline"><mrow><mi>x</mi></mrow></math>. No caso da equação diferencial
resolvida neste exemplo, existem métodos analíticos que permitem
encontrar a expressão para a curva contínua que foi apresentada na
figura; nos casos em que não é possível encontrar a solução analítica,
o método de Runge-Kutta de quarta ordem é uma boa opção para encontrar
uma boa aproximação numérica.
</p>
<figure class="center" id="fig-3.8">
<img class="fig" src="img/exemplo_Runge-Kutta.png"
     style="width:21.357em;max-width:100%;height:auto"
     alt="Exemplo do uso do método de Runge-Kutta">
<figcaption>
<b>Figura 3.8:</b> Solução exata e solução obtida com o método de
Runge-Kutta de quarta ordem.
</figcaption>
</figure>
<p>
Já existe uma função <span class="concept">rk</span> predefinida no
Maxima que executa o método de Runge-Kutta de quarta ordem. No exemplo
acima, bastava indicar a expressão de <math id="eqn194" display="inline"><mrow><mi>f</mi><mo stretchy="false">(</mo><mi>x</mi><mo>,</mo><mi>y</mi><mo stretchy="false">)</mo></mrow></math>, o nome que identifica
a variável dependente, o seu valor inicial e o intervalo em que se
quer obter a solução, incluindo o valor dos incrementos <math id="eqn195" display="inline"><mrow><mi>h</mi></mrow></math>. Assim
sendo, a mesma lista obtida com os
comandos <span class="maxp">(%i17)</span>
até <span class="maxp">(%i21)</span> podia ser obtida com um único
comando:
</p>
<pre>
<span class="maxp">(%i25)</span> <span class="maxi">rk ((x-1)*(x-3)-y, y, 1, [x, 0, 4, 1]);</span><br>
(%o25) [[0.0, 1.0], [1.0, 1.020833333333333], [2.0, -0.09635416666666652],<br>
        [3.0, -0.3902994791666666], [4.0, 0.8744710286458335]]
</div>
</section>
<section>
<h2 id="sec-3.3">3.3. Sistemas de equações diferenciais</h2>
<p>
Os métodos descritos nas secções anteriores podem ser generalizados
facilmente a um sistema de várias equações, quando sejam conhecidas
condições iniciais para todas as variáveis. Tal como se explica no
inicio do capítulo, basta admitir que <math id="eqn196" display="inline"><mrow><mi>y</mi></mrow></math> é um vetor e que <math id="eqn197" display="inline"><mrow><mi>f</mi></mrow></math> é uma
função vetorial.
</p>
<div class="example">
<h3 id="ex-3.2">Exemplo 3.2</h3>
<p>
Usando o método de Runge-Kutta de quarta ordem, encontre a solução do
seguinte sistema de equações diferenciais:
</p>
<math id="eqn198" display="block"><mrow><mrow><mrow><mo stretchy="true" fence="true" form="prefix">{</mo><mtable><mtr><mtd columnalign="left"><mstyle displaystyle="true" scriptlevel="0"><mfrac><mrow><mi>d</mi><mi>x</mi></mrow><mrow><mi>d</mi><mi>t</mi></mrow></mfrac></mstyle><mo>=</mo><mn>4</mn><mo>−</mo><msup><mi>x</mi><mn>2</mn></msup><mo>−</mo><mn>4</mn><mspace width="0.167em" /><msup><mi>y</mi><mn>2</mn></msup></mtd></mtr><mtr><mtd columnalign="left"><mo stretchy="false">[</mo><mn>4pt</mn><mo stretchy="false">]</mo><mstyle displaystyle="true" scriptlevel="0"><mfrac><mrow><mi>d</mi><mi>y</mi></mrow><mrow><mi>d</mi><mi>t</mi></mrow></mfrac></mstyle><mo>=</mo><msup><mi>y</mi><mn>2</mn></msup><mo>−</mo><msup><mi>x</mi><mn>2</mn></msup><mo>+</mo><mn>1</mn></mtd></mtr></mtable></mrow></mrow></mrow></math>
<p>
no intervalo, <math id="eqn199" display="inline"><mrow><mn>0</mn><mi>&</mi><mi>l</mi><mi>e</mi><mi>;</mi><mi>t</mi><mi>&</mi><mi>l</mi><mi>e</mi><mi>;</mi><mn>4</mn></mrow></math>, com condições iniciais <math id="eqn200" display="inline"><mrow><msub><mi>x</mi><mn>0</mn></msub><mo>=</mo><mo>−</mo><mn>1.25</mn></mrow></math>
e <math id="eqn201" display="inline"><mrow><msub><mi>y</mi><mn>0</mn></msub><mo>=</mo><mn>0.75</mn></mrow></math>, em <math id="eqn202" display="inline"><mrow><msub><mi>t</mi><mn>0</mn></msub><mo>=</mo><mn>0</mn></mrow></math>.
</p>
</div>
<p>
<b>Resolução</b>. A variável independente é <math id="eqn203" display="inline"><mrow><mi>t</mi></mrow></math> e a variável
dependente é o vetor <math id="eqn204" display="inline"><mrow><mover><mrow><mi>r</mi></mrow><mo stretchy="false">→</mo></mover><mo>=</mo><mo stretchy="false">(</mo><mi>x</mi><mo>,</mo><mi>y</mi><mo stretchy="false">)</mo></mrow></math>, que no Maxima representa-se por
uma lista com duas partes, [<math id="eqn205" display="inline"><mrow><mi>x</mi></mrow></math>, <math id="eqn206" display="inline"><mrow><mi>y</mi></mrow></math>]. A expressão <math id="eqn207" display="inline"><mrow><mover><mrow><mi>f</mi></mrow><mo stretchy="false">→</mo></mover></mrow></math> que
define as derivadas das variáveis dependentes também será uma lista
com duas partes, [<math id="eqn208" display="inline"><mrow><mn>4</mn><mo>−</mo><msup><mi>x</mi><mn>2</mn></msup><mo>−</mo><mn>4</mn><mspace width="0.167em" /><msup><mi>y</mi><mn>2</mn></msup></mrow></math>, <math id="eqn209" display="inline"><mrow><msup><mi>y</mi><mn>2</mn></msup><mo>−</mo><msup><mi>x</mi><mn>2</mn></msup><mo>+</mo><mn>1</mn></mrow></math>], mas é mais conveniente
(para poder generalizar ao caso de <math id="eqn210" display="inline"><mrow><mi>n</mi></mrow></math> variáveis) representá-la em
função das componentes da lista <math id="eqn211" display="inline"><mrow><mi>r</mi></mrow></math>:
</p>
<pre>
<span class="maxp">(%i26)</span> <span class="maxi">f(t,r) := [4-r[1]^2-4*r[2]^2, r[2]^2-r[1]^2+1]$</span>
</pre>
<p>
foi dada também a variável independente <math id="eqn212" display="inline"><mrow><mi>t</mi></mrow></math> como argumento da função,
a pesar de que neste caso <math id="eqn213" display="inline"><mrow><mover><mrow><mi>f</mi></mrow><mo stretchy="false">→</mo></mover></mrow></math> não depende de <math id="eqn214" display="inline"><mrow><mi>t</mi></mrow></math>, para que os
comandos usados a seguir possam ser reutilizados em casos mais gerais.
</p>
<p>
Com as condições iniciais <math id="eqn215" display="inline"><mrow><msub><mi>t</mi><mn>0</mn></msub></mrow></math> = 0 e <math id="eqn216" display="inline"><mrow><msub><mover><mrow><mi>r</mi></mrow><mo stretchy="false">→</mo></mover><mn>0</mn></msub></mrow></math> = (-1.25, 0.75)
cria-se a lista onde serão guardados os resultados das iterações
</p>
<pre>
<span class="maxp">(%i27)</span> <span class="maxi">p: [[0.0, -1.25, 0.75]]$</span>
</pre>
<p>
Observe-se que a lista inicial [0.0, -1.25, 0.75] e todas as outras
listas que serão acrescentadas, incluem a variável independente <math id="eqn217" display="inline"><mrow><mi>t</mi></mrow></math> e
o vetor dependente <math id="eqn218" display="inline"><mrow><mover><mrow><mi>r</mi></mrow><mo stretchy="false">→</mo></mover></mrow></math>. Para extrair apenas a variável
independente <math id="eqn219" display="inline"><mrow><mi>t</mi></mrow></math> usa-se o comando <span class="concept">first</span>,
que extrai o primeiro elemento de uma lista e para extrair o vector
<math id="eqn220" display="inline"><mrow><mover><mrow><mi>r</mi></mrow><mo stretchy="false">→</mo></mover></mrow></math> usa-se o comando <span class="concept">rest</span>, que
produz uma nova lista excluindo o primeiro elemento da lista original;
ou seja, rest([0.0, -1.25, 0.75]) produz [-1.25, 0.75].
</p>
<p>
Usando incrementos <math id="eqn221" display="inline"><mrow><mi>h</mi><mo>=</mo><mn>0.02</mn></mrow></math> para a variável independente <math id="eqn222" display="inline"><mrow><mi>t</mi></mrow></math>, será
necessário realizar 200 iterações para terminar em <math id="eqn223" display="inline"><mrow><mi>t</mi><mo>=</mo><mn>4</mn></mrow></math>.
</p>
<pre>
<span class="maxp">(%i28)</span> <span class="maxi">h: 0.02$</span><br>
<span class="maxp">(%i29)</span> <span class="maxi">for i thru 200 do (</span><br>
           <span class="maxi">ti: first (last(p)),</span><br>
           <span class="maxi">ri: rest (last(p)),</span><br>
           <span class="maxi">d1: f (ti, ri),</span><br>
           <span class="maxi">d2: f (ti+h/2, ri+(h/2)*d1),</span><br>
           <span class="maxi">d3: f (ti+h/2, ri+(h/2)*d2),</span><br>
           <span class="maxi">d4: f (ti+h, ri+h*d3),</span><br>
           <span class="maxi">p: endcons (cons (ti+h, ri+h*(d1+2*d2+2*d3+d4)/6), p)</span><br>
       <span class="maxi">)$</span>
</pre>
<p>
O comando <span class="concept">cons</span> é semelhante
a <span class="maxf">endcons</span>, mas insere um elemento no início
de uma lista, em vez de no fim. Neste
caso, <span class="concept">cons</span> foi usado para inserir o valor
de <math id="eqn224" display="inline"><mrow><mi>t</mi></mrow></math> na lista [<math id="eqn225" display="inline"><mrow><mi>x</mi></mrow></math>, <math id="eqn226" display="inline"><mrow><mi>y</mi></mrow></math>], produzindo a lista [<math id="eqn227" display="inline"><mrow><mi>t</mi></mrow></math>, <math id="eqn228" display="inline"><mrow><mi>x</mi></mrow></math>, <math id="eqn229" display="inline"><mrow><mi>y</mi></mrow></math>], que
foi logo acrescentada no fim da lista <math id="eqn230" display="inline"><mrow><mi>p</mi></mrow></math> dos resultados.
</p>
<p>
O último ponto na solução obtida é:
</p>
<pre>
<span class="maxp">(%i30)</span> <span class="maxi">last (p);</span><br>
(%o30) [4.000000000000003, 1.232365393486131, -0.7493152366008236]
</pre>
<p>
O mesmo resultado podia ter sido obtido com o
comando <span class="maxf">rk</span>
</p>
<pre>
<span class="maxp">(%i31)</span> <span class="maxi">p: rk ([4-x^2-4*y^2, y^2-x^2+1], [x, y], [-1.25, 0.75], [t, 0, 4, h])$</span>
</pre>
<p>
Para imprimir os resultados é conveniente
usar <span class="concept">printf</span>. Esse comando aceita um
formato do <i>Lisp</i> que diz como devem ser imprimidos os
dados. Neste exemplo pode usar se o formato
"&sim;{&sim;{&sim;f&sim;^,&nbsp;}&sim;%&sim;}" para imprimir os 3
elementos <math id="eqn231" display="inline"><mrow><mi>t</mi></mrow></math>, <math id="eqn232" display="inline"><mrow><mi>x</mi></mrow></math> e <math id="eqn233" display="inline"><mrow><mi>y</mi></mrow></math> de cada iteração numa linha separada,
separados por uma vírgula e um espaço. Os dois
símbolos <kbd>&sim;{</kbd> e <kbd>&sim;}</kbd> usam-se para delimitar
um formato que deve ser aplicado recursivamente a todos os elementos
de uma lista, neste caso a lista <math id="eqn234" display="inline"><mrow><mi>p</mi></mrow></math>. Dentro desses símbolos, o
formato <kbd>&sim;{&sim;f&sim;^, &sim;}&sim;%</kbd> aplicará
recursivamente o formato <kbd>&sim;f&nbsp;^, </kbd> a cada elemento
das sublistas de <math id="eqn235" display="inline"><mrow><mi>p</mi></mrow></math>, neste caso a <math id="eqn236" display="inline"><mrow><msub><mi>t</mi><mi>i</mi></msub></mrow></math>, <math id="eqn237" display="inline"><mrow><msub><mi>x</mi><mi>i</mi></msub></mrow></math> e <math id="eqn238" display="inline"><mrow><msub><mi>y</mi><mi>i</mi></msub></mrow></math>, seguido de um
de fim de linha, representado pelo símbolo <kbd>&sim;%</kbd>. O
símbolo <kbd>&sim;f</kbd> é usado para escrever números de vírgula
flutuante e o símbolo <kbd>&sim;^</kbd> indica que o que vem a seguir
só será escrito se não se tiver chegado ao último elemento da lista;
ou seja, será escrita uma vírgula e um espaço após <math id="eqn239" display="inline"><mrow><msub><mi>t</mi><mi>i</mi></msub></mrow></math> e <math id="eqn240" display="inline"><mrow><msub><mi>x</mi><mi>i</mi></msub></mrow></math>, mas
não após <math id="eqn241" display="inline"><mrow><msub><mi>y</mi><mi>i</mi></msub></mrow></math>.
</p>
<p>
Para imprimir unicamente os 9 resultados para <math id="eqn242" display="inline"><mrow><mi>t</mi><mo>=</mo><mn>0</mn><mo>,</mo><mn>0.5</mn></mrow></math>,&hellip; ,4,
extraem-se unicamente esses elementos da lista <math id="eqn243" display="inline"><mrow><mi>p</mi></mrow></math>, usando o
comando <span class="concept">makelist</span>:
</p>
<pre>
<span class="maxp">(%i32)</span> <span class="maxi">printf (true,"~{~{~f~^, ~}~%~}", makelist(p[25*i+1],i,0,8))$</span><br>
0.0, -1.25, 0.75<br>
0.5000000000000001, -1.1773384444565893, 0.8294212227394446<br>
1.0000000000000004, -1.5811924578377141, 0.818421880110717<br>
1.5000000000000009, -1.5173593339612323, 0.03778051398450264<br>
2.0000000000000013, -0.0005587219405601973, 0.06781851774672522<br>
2.5000000000000018, 1.4685416405394016, 0.148009097100235<br>
3.000000000000002, 1.6981292199163442, -0.7368848754678627<br>
3.5000000000000027, 1.188041502209304, -0.8582807863663763<br>
4.000000000000003, 1.232365393486131, -0.7493152366008236
</pre>
<p>
Finalmente, pode ser conveniente gravar esses resultados num
ficheiro. Por exemplo, os programas de folha de cálculo conseguem ler
dados como estão apresentados acima, dentro de ficheiros do tipo CSV
(<em>Comma Separated Values</em>). Para gravar o que é apresentado no
ecrã num ficheiro, usa-se o
comando <span class="concept">with_stdout</span>
</p>
<pre>
<span class="maxp">(%i33)</span> <span class="maxi">with_stdout ("resultados.csv",</span><br>
           <span class="maxi">printf(true,"~{~{~f~^, ~}~%~}", makelist(p[25*i+1],i,0,8))</span><br>
       <span class="maxi">)$</span>
</pre>
<p>
Os resultados ficam gravados no ficheiro <kbd>resultados.csv</kbd>
</p>
</section>
<footer>
<p>&copy; 2016-2025, Jaime E. Villate</p>
<p>Publicado nos termos da <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Licença Creative Commons Atribuição-Partilha</a> (versão 4.0).</p>
<span>Última modificação: 2025/03/08 12:10:45 UTC</span>
</footer>
</body>
</html>
